\usepackage{listings}
\usepackage{makecell}
\usepackage{xcolor}
\usepackage{adjustbox}
% \usepackage{stmaryrd}

\usepackage[normalem]{ulem} 

\lstset{
  basicstyle=\ttfamily,
  numberstyle=\ttfamily,
  literate={-{}}{-{}}1 {\$}{\$}1,
  mathescape=true,
  escapechar=ยง,
  extendedchars=true}

\lstdefinestyle{marks}{
  moredelim=**[is][\color{red}]{@}{@},
  moredelim=**[is][\color{blue}]{`}{`},
  moredelim=**[is][\color{gray}]{\\}{\\}}

\lstdefinestyle{cmarks}{
  moredelim=**[is][\color{red}]{@}{@},
  moredelim=**[is][\color{blue}]{`}{`}}

\lstdefinestyle{rthree}{
  moredelim=**[is][\color{red}]{`}{`},
  literate={L}{\texttt{\textcolor{gray}{\grk{l}}}}1,
  keywordstyle={\color{gray}},
  keywords={ext,run,bind,cell,WRef,WTree,Flow,Int,tree,rec,or,span},
  otherkeywords={->,!}
}

% \lstdefinestyle{rfour}{
%   moredelim=**[is][\color{blue}]{@}{@},
%   moredelim=**[is][\color{red}]{`}{`},
%   literate={L}{\texttt{\textcolor{gray}{\grk{l}}}}1
%            {->}{{\textcolor{gray}{$\to$}}}2
%            {T}{\(\mathtt{\times}\)}1
%            {A}{\(\mathtt{\wedge}\)}1
%            {C}{\(\mathtt{\circ}\)}1,
%   keywordstyle={\color{gray}},
%   keywords={either,run,pin,rec,enum,span,define,if,get,path,let,flow,zip,def,claim,type}
% }

\lstdefinestyle{rfour}{
  moredelim=**[is][\color{blue}]{@}{@},
  moredelim=**[is][\color{red}]{`}{`},
  literate={\\}{\texttt{\grk{l}}}1
           {P}{\texttt{\grk{P}}}1
           {^}{$\shortrightarrow$}1
           {,}{\(\mathtt{\times}\)}1
%           {A}{\(\mathtt{\wedge}\)}1
           {@}{\(\mathtt{\circ}\)}1,
  keywordstyle={\color{gray}},
  keywords={run,pin,rec,enum,span,get,path,flow,zip}}

\lstdefinestyle{hask}{
  language=Haskell,
  stringstyle={\color[rgb]{0.75,0.49,0.07}},
  keywordstyle={\color{gray}},
}

\lstdefinestyle{cee}{
  language=C,
  keywordstyle={\color{gray}},
}

\lstdefinestyle{scm}{
  morekeywords=[1]{define, define-syntax, define-macro, lambda, define-stream, stream-lambda},
  morekeywords=[2]{begin, call-with-current-continuation, call/cc,
    call-with-input-file, call-with-output-file, case, cond,
    do, else, for-each, if, unless, when
    let*, let, let-syntax, letrec, letrec-syntax,
    let-values, let*-values,
    and, or, not, delay, force, car, cdr,
    quasiquote, quote, unquote, unquote-splicing,
    map, fold, syntax, syntax-rules, eval, environment, query },
  morekeywords=[3]{import, export},
  alsodigit=!\$\%&*+-./:<=>?@^_~,
  sensitive=true,
  morecomment=[l]{;},
  morecomment=[s]{\#|}{|\#},
  morestring=[b]",
  basicstyle=\small\ttfamily,
  keywordstyle=\bf\ttfamily\color[rgb]{0,.3,.7},
  commentstyle=\color[rgb]{0.133,0.545,0.133},
  stringstyle={\color[rgb]{0.75,0.49,0.07}},
  upquote=true,
  breaklines=false,
  breakatwhitespace=true,
  literate=*{`}{{`}}{1},
  showstringspaces=false,
  keywordstyle=\color{gray}
}

\newenvironment{clist}{\begin{center}\begin{mcellbox}}{\end{mcellbox}\end{center}}

\newenvironment{alist}{\begin{center}\begin{adjustbox}{width=\linewidth}\begin{mcellbox}}%
                      {\end{mcellbox}\end{adjustbox}\end{center}}
