% Λ-абстракции

% Схемы для определения функций. Аппликативный (f x y) и классический
% f(x,y) стили. Суффиксы генерируемых команд соответствуют общей схеме,
% приведённой в commands.tex. У обоих схем два параметра: базовое имя для
% макроса и визуальное обозначение функции. Примеры:
%
%   \fnscheme{im}{\mathrm{im}};
%   \imx{a b c}
%     → \left(\mathrm{im}\ a\ b\ c\right)

\newcommand\indexes[4]{{#1}_{{#2}={#3}}^{#4}}
\newcommand\indexesm[4]{{#1{#2}}_{{#2}={#3}}^{#4}}

% \newcommand\fnscheme[2]{%
%   \expandafter\newcommand\csname#1i\endcsname[0]{%
%     \ensuremath{#2}}
% 
%   \expandafter\newcommand\csname#1x\endcsname[1]{%
%     \Pars{{#2}\ \nomapinset{\ }{##1}}}
% 
%   \expandafter\newcommand\csname#1r\endcsname[2]{%
%     \Pars{\nomapinset{\ }{{#2} {##1} {\dots} {##2}}}}
% 
%   \expandafter\newcommand\csname#1e\endcsname[3]{%
%     \csname#1f\endcsname{##1}{##2}{1}{##3}}
% 
%   \expandafter\newcommand\csname#1f\endcsname[4]{%
%     \Pars{\nomapinset{\ }{{#2} {\indexes{##1}{##2}{##3}{##4}}}}}
% 
%   \expandafter\newcommand\csname#1mx\endcsname[2]{%
%     \Pars{{#2}\ \simpleinset{\ }{##1}{##2}}}
% 
%   \expandafter\newcommand\csname#1mr\endcsname[3]{%
%     \Pars{\nomapinset{\ }{{#2} {##1{##2}} {\dots} {##1{##3}}}}}
% 
%   \expandafter\newcommand\csname#1me\endcsname[3]{%
%     \csname#1mf\endcsname{##1}{##2}{1}{##3}}
% 
%   \expandafter\newcommand\csname#1mf\endcsname[4]{%
%     \Pars{\nomapinset{\ }{{#2} {\indexesm{##1}{##2}{##3}{##4}}}}}
% }

\newcommand\fnscheme[2]{%
  \expandafter\newcommand\csname#1i\endcsname[0]{%
    \ensuremath{#2}}

  \expandafter\newcommand\csname#1x\endcsname[1]{%
    \ensuremath{{#2}\!\Pars{\nomapinset{,}{##1}}}}

  \expandafter\newcommand\csname#1r\endcsname[2]{%
    \ensuremath{{#2}\!\Pars{\nomapinset{,}{{##1} {\dots} {##2}}}}}

  \expandafter\newcommand\csname#1e\endcsname[3]{%
    \csname#1f\endcsname{##1}{##2}{1}{##3}}

  \expandafter\newcommand\csname#1f\endcsname[4]{%
    \ensuremath{{#2}\!\Pars{\indexes{##1}{##2}{##3}{##4}}}}

  \expandafter\newcommand\csname#1mx\endcsname[2]{%
    \ensuremath{{#2}\!\Pars{\simpleinset{,}{##1}{##2}}}}

  \expandafter\newcommand\csname#1mr\endcsname[3]{%
    \ensuremath{{#2}\!\Pars{\nomapinset{,}{{##1{##2}} {\dots} {##1{##3}}}}}}

  \expandafter\newcommand\csname#1me\endcsname[3]{%
    \csname#1mf\endcsname{##1}{##2}{1}{##3}}

  \expandafter\newcommand\csname#1mf\endcsname[4]{%
    \ensuremath{{#2}\!\Pars{\indexesm{##1}{##2}{##3}{##4}}}}
}

\newcommand\cappargs[1]{\nomapinset{,}{#1}}
\newcommand\appargs[1]{\nomapinset{\ }{#1}}

\newcommand\capp[2]{\ensuremath{{#1}\pars{\cappargs{#2}}}}
\newcommand\dcapp[3]{\ensuremath{{#1}{#3{\cappargs{#2}}}}}

\newcommand\app[2]{\pars{{#1}\ \appargs{#2}}}
\newcommand\dapp[3]{\ensuremath{#3{{#1}\ \appargs{#2}}}}

% \newcommand\comp[1]{\nomapinset{\circ}{#1}}

\keywordscheme{L}{\grk{l}}
\keywordscheme{pi}{\grk{p}}

\enumscheme{aft}{\circ}

\newcommand\lam[1]{\ensuremath{\lambda#1\ldotp}}

% \newcommand{\capp}[1]{%
%   \begingroup%
%   \def\inset{,}%
%   \def\mapitem{\identity}%
%   \def\maphead{\identity}%
%   \def\pretail{(}%
%   \def\posttail{)}%
%   \ensuremath{\headsplitmap{#1}}%
%   \endgroup}
% 
% \ifclassic
%   \newcommand\app[1]{\capp{#1}}
%   \newcommand\papp[1]{\capp{#1}}
% \else
%   \newcommand{\app}[1]{%
%     \begingroup%
%     \def\inset{\,}%
%     \def\mapitem{\identity}%
%     \ensuremath{\insetmap{#1}}%
%     \endgroup}
% 
%   \newcommand{\papp}[1]{\ensuremath{(\app{#1})}}
% \fi
%
% \newcommand\fndom[1]{%
%   \begingroup%
%   \def\inset{\to}%
%   \def\mapitem{\identity}%
%   \ensuremath{\insetmap{#1}}%
%   \endgroup}

\newcommand\fnspace[1]{\nomapinset{\to}{#1}}
